<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Tarea AJAX</title>
    <style>
        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body>

    <label for="nombres">Selecciona un nombre:</label>
    <select id="nombres" onchange="cargarDetalle(this.value)">
        <option value="">Cargando...</option>
    </select>


    <div id="datos_contenedor">La tabla se cargará aquí...</div>

    <script>
        const urlServidor = "jsonGET.php";

        // Función genérica para manejar la lógica AJAX
        function enviarPeticion(url, funcionRespuesta) {
            $.get(url,
            function(obj) {
                funcionRespuesta(obj);
            });

        }


        function procesarNombres(json) {
            let select = document.getElementById("nombres");

            // Limpia el cargando inicial
            select.innerHTML = '<option value="" disabled selected>Selecciona un nombre</option>';

            // Itera sobre el array de nombres devuelto por el PHP
            json.forEach(item => {
                let option = document.createElement("option");
                option.value = item.id;
                option.textContent = item.nombre;
                select.appendChild(option);
            });
        }

        //Carga el detalle del nombre seleccionado en una tabla.
        function cargarDetalle(id) {
            if (id === "") {
                document.getElementById("datos_contenedor").innerHTML = "La tabla se cargará aquí...";
                return;
            }
            const url = `${urlServidor}?id=${id}`;
            enviarPeticion(url, procesarDetalle);
        }

        function procesarDetalle(json) {
            let htmlTabla = '<h3>Datos del Usuario</h3>';

            // Construir la tabla con los datos del objeto
            htmlTabla += '<table>';
            htmlTabla += `<tr><td>ID</td><td>${json.id}</td></tr>`;
            htmlTabla += `<tr><td>Nombre</td><td>${json.nombre}</td></tr>`;
            htmlTabla += `<tr><td>Apellidos</td><td>${json.apellidos}</td></tr>`;
            htmlTabla += `<tr><td>Ciudad</td><td>${json.ciudad}</td></tr>`;
            htmlTabla += '</table>';

            document.getElementById("datos_contenedor").innerHTML = htmlTabla;
        }

        // Llama a la primera función al cargar el script.
        document.addEventListener('DOMContentLoaded', function () {
            enviarPeticion(urlServidor, procesarNombres);
        });
    </script>
</body>

</html>