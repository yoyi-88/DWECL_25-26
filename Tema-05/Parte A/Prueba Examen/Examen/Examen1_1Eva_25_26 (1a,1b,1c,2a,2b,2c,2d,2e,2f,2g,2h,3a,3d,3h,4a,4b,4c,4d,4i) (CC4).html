<!DOCTYPE html>
<html>
<script>
    function menu() {
        //do

        // Función principal que coordina la ejecución del programa
        // Llama a las demás funciones para introducir datos, procesarlos y mostrar los resultados
        let secciones = introducirSecciones();
        let maquinas = introducirMaquinas();
        let sensores = introducirSensores();
        let array = introducirTemperaturas(secciones, maquinas, sensores);
        let media = calcularMedias(array, secciones, maquinas, sensores);
        let maximo = maximoPorSeccion(array, secciones, maquinas, sensores);
        let sobrecalentamiento = detectarSobrecalentamientos(array, secciones, maquinas, sensores);
        mostrarResultados(media, maximo, sobrecalentamiento);
        mensaje = continuar();
        //while (mensaje = "si");

    }

    // function continuar() {
    //     let mensaje = prompt("Desea otro ciclo? s/n");
    //     return mensaje;
    // }

    function introducirSecciones() {
        let secciones = Number(prompt("Introduzca número de secciones"));
        return secciones;
    }
    function introducirMaquinas() {
        let maquinas = Number(prompt("Introduzca número de máquinas"));
        return maquinas;
    }
    function introducirSensores() {
        let sensores = Number(prompt("Introduzca número de sensores"));
        return sensores;
    }

    function introducirTemperaturas(secciones, maquinas, sensores) {

        let array = []; // Crea el array para guardar temperaturas

        // Pide al usuario las temperaturas de cada sensor mediante bucles anidados
        for (let i = 0; i != secciones; i++) {
            array[i] = [];
            for (let j = 0; j != maquinas; j++) {
                array[i][j] = [];
                for (let k = 0; k != sensores; k++) {
                    array[i][j][k] = Number(prompt("Introduzca temperatura \n" + `Sección: ${i} \n Máquina ${j} \n Sensor: ${k}`));
                }
            }
        }
        return array; // Devuelve el array completo de temperaturas

    }

    function calcularMedias(array, secciones, maquinas, sensores) {

        let media = [];
        let numFin = 0;

        // Calcula la media de los sensores por cada máquina en cada sección
        for (let i = 0; i != secciones; i++) {
            media[i] = [];
            for (let j = 0; j != maquinas; j++) {
                media[i][j] = [];
                for (let k = 0; k != sensores; k++) {
                    numFin += Number(array[i][j][k]);
                }
                media[i][j] = numFin / sensores; // Promedio de 5 sensores
                numFin = 0;
            }
        }
        return media;

    }

    function maximoPorSeccion(array, secciones, maquinas, sensores) {
        let maximo = [];
        let numMax = 0;

        // Determina la temperatura máxima registrada en cada sección
        for (let i = 0; i != secciones; i++) {
            maximo[i] = [];
            for (let j = 0; j != maquinas; j++) {
                for (let k = 0; k != sensores; k++) {
                    if (numMax < array[i][j][k]) {
                        numMax = array[i][j][k];
                    }
                }
            }
            maximo[i] = numMax;
            numMax = 0;
        }
        return maximo;
    }

    function detectarSobrecalentamientos(array, secciones, maquinas, sensores) {
        let tempMax = 100;
        let sobrecalentamiento = [];

        // Verifica si hay temperaturas mayores a 100 y marca “Sobrecalentamiento detectado” o “OK”
        for (let i = 0; i != secciones; i++) {
            sobrecalentamiento[i] = [];
            for (let j = 0; j != maquinas; j++) {
                sobrecalentamiento[i][j] = [];
                for (let k = 0; k != sensores; k++) {
                    if (array[i][j][k] > tempMax) {
                        sobrecalentamiento[i][j][k] = `Sobrecalentamiento detectado`;
                    } else {
                        sobrecalentamiento[i][j][k] = `OK`;
                    }
                }
            }
        }
        return sobrecalentamiento;
    }

    function mostrarResultados(media, maximo, sobrecalentamiento) {
        let mensaje = "Resultados ejercicio \n \n";

        // Muestra las medias calculadas por máquina
        mensaje += "Temperatura media por máquina: \n"
        for (let i = 0; i != media.length; i++) {
            for (let j = 0; j != media[i].length; j++) {
                mensaje += `Sección ${i}, máquina ${j}, media: ${media[i][j]} \n`;
            }
        }

        mensaje += "\n";

        // Muestra el valor máximo de temperatura por sección
        mensaje += "Máximo por sección: \n";
        for (let i = 0; i != maximo.length; i++) {
            mensaje += `Sección ${i}: ${maximo[i]} \n`;
        }

        mensaje += "\n";

        // Indica el estado de sobrecalentamiento por cada sensor
        mensaje += "Indicador de sobrecalentamiento: \n"
        for (let i = 0; i != sobrecalentamiento.length; i++) {
            for (let j = 0; j != sobrecalentamiento[i].length; j++) {
                for (let k = 0; k != sobrecalentamiento[i][j].length; k++) {
                    mensaje += `Sección ${i}, máquina ${j}, sensor: ${k}: ${sobrecalentamiento[i][j][k]} \n`;
                }
            }
        }
        alert(mensaje); // Muestra los resultados en una alerta
    }

    menu(); // Llama a la función principal para iniciar el programa
</script>
</html>
