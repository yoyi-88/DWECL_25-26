<html>

<body>
    <script>
        class Articulo {
            #art = {};
            constructor(codigo, nombre, precio, cantidad) {
                this.#art.codigo = codigo;
                this.#art.nombre = nombre;
                this.#art.precio = precio;
                this.#art.cantidad = cantidad;
                return this.#art;
            }


        }

        class Cesta {
            cesta = [];
            codigoSiguiente = 1;

            añadirArticulo() {
                let codigo = 0;
                let nombre = prompt("Inserte el nombre del producto");
                let precio = Number(prompt("Inserte el precio del producto"));
                let cantidad = Number(prompt("Inserte la cantidad del producto"));

                if (this.codigoSiguiente < 0 || nombre == null || precio < 0 || cantidad < 1) {
                    alert('Se ha declarado algún dato inválido')
                    return null;
                }

                let art = new Articulo(this.codigoSiguiente, nombre, precio, cantidad);

                this.cesta.push(art);

                this.codigoSiguiente++;

            }

            verCesta() {
                if (this.cesta.length === 0) {
                    alert("La cesta está vacía");
                    return null;
                }

                let mensaje = "Cesta \n";
                mensaje += "cod | nombre | Precio | Cantidad | Subtotal \n";

                let totalCesta = 0;

                // Recorremos cada producto del array
                for (let producto of this.cesta) {
                    let subtotal = producto.precio * producto.cantidad;
                    totalCesta += subtotal; // Sumamos el subtotal al total

                    // .toFixed(2) es para mostrar 2 decimales
                    mensaje += `${producto.codigo}\t| ${producto.nombre}\t| ${producto.precio.toFixed(2)}€\t| ${producto.cantidad}\t| ${subtotal.toFixed(2)}€\n`;
                }
                mensaje += `TOTAL: ${totalCesta.toFixed(2)}€`;
                return alert(mensaje);

            }

            borrarArticulo() {
                if (this.cesta.length === 0) {
                    alert("La cesta ya está vacía.");
                    return;
                }



                let codABorrar = Number(prompt("Inserte el código del artículo que desea borrar:"));

                // Buscar el índice del producto en la cesta y si no lo encuentra devuelve 1
                let indice = this.cesta.findIndex(producto => producto.codigo === codABorrar);

                // 4. Procesar el resultado
                if (indice !== -1) {
                    // .splice elimina 1 elemento en la posición indice
                    this.cesta.splice(indice, 1);
                    console.log(this.cesta);
                    alert(`Artículo con código ${codABorrar} borrado exitosamente.`);
                    return this.cesta;
                } else {
                    alert(`Error: No se encontró ningún artículo con el código ${codABorrar}.`);
                    return this.cesta;
                }

            }

            vaciarCesta() {
                if (this.cesta.length === 0) {
                    alert("La cesta ya está vacía.");
                    return this.cesta;
                }

                alert("La cesta se ha vaciado");
                // Igualamos el array a un array vacío;
                return this.cesta = [];
            }

            


        }

        class Menu extends Cesta {
            
            iniciarMenu() {
                let opcion;
                let salir = false;

                while (salir === false) {
                    opcion = Number(prompt("Seleccione una opción (número): \n 1. Ver cesta \n 2. Insertar un artículo \n 3. Borrar un artículo \n 4. Vaciar cesta \n 5. Salir"));
                    switch (opcion) {
                        case 1:
                            this.verCesta();
                            break;
                        case 2:
                            this.añadirArticulo();
                            break;
                        case 3:
                            this.borrarArticulo();
                            break;
                        case 4:
                            this.vaciarCesta();
                            break;
                        case 5:
                            salir = true;
                            alert("Cerrando programa...");
                            break;

                    }
                }
            }
        }

        var menu = new Menu();
        menu.iniciarMenu();



    </script>
</body>

</html>