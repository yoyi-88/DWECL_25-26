<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <style>
        .centra {
            border: 1px solid grey;
            text-align: center;
        }

        .borde {
            border: 1px solid grey;
        }

        .negrita {
            font-weight: bold;
        }
    </style>

</head>

<body>
    <script>

        // Cadena 'bdDallo', contiene todos los costes en euros (materiales, mano de obra, etc...)
        //  para realizar el escandallo de una serie de carteras de piel recibido desde una BBDD.

        const bdDallo = `[{ "cod": 1,
                        "descrip": "cartera piel vacuno negra",
                        "costos":{ "piel": 5,
                                   "hilo": 0.80,
                                   "rebaje": 1,
                                   "pegamento": 0.50,
                                   "pintura": 0.45,
                                   "broches": 0.90,
                                   "cosido": 1,
                                   "fabricaciÃ³n": 15,
                                   "embasado": 1}                
                   },
                   {    "cod": 2,
                        "descrip": "cartera piel vacuno azul",
                        "costos":{ "piel": 6,
                                   "hilo": 0.90,
                                   "rebaje": 1.50,
                                   "pegamento": 0.70,
                                   "pintura": 0.50,
                                   "broches": 0.80,
                                   "cosido": 1.50,
                                   "fabricaciÃ³n": 16,
                                   "embasado": 1.20}                
                   },
                   {    "cod": 3,
                        "descrip": "cartera piel coco",
                        "costos":{ "piel": 25,
                                   "hilo": 1,
                                   "rebaje": 1,
                                   "pegamento": 0.70,
                                   "pintura": 0.80,
                                   "broches": 1,
                                   "cosido": 3,
                                   "fabricaciÃ³n": 20,
                                   "embasado": 5}               
                   }]`

        class Secc {
            constructor() {
            }

            crearCabecera() {
                let cabecera = document.createElement('tr');

                let cod = document.createElement('td');
                cod.innerHTML = 'COD';
                cod.classList.add('centra');

                let descripcion = document.createElement('td');
                descripcion.innerHTML = 'DESCRIPCIÃ“N';
                descripcion.classList.add('centra');


                let costos = document.createElement('td');
                costos.innerHTML = 'COSTO â‚¬';
                costos.classList.add('centra');



                cabecera.appendChild(cod);
                cabecera.appendChild(descripcion);
                cabecera.appendChild(costos);

                return cabecera;
            }

            crearModeloCartera(id, nombre) {
                let producto = document.createElement('tr');

                let idProducto = document.createElement('td');
                idProducto.innerHTML = id;
                idProducto.classList.add('borde');

                let nombreProducto = document.createElement('td');
                nombreProducto.innerHTML = nombre;
                nombreProducto.classList.add('negrita');
                nombreProducto.classList.add('borde');

                let espacio = document.createElement('td');
                espacio.classList.add('borde');

                producto.appendChild(idProducto);
                producto.appendChild(nombreProducto);
                producto.appendChild(espacio);

                return producto;
            }

            crearCostes(costes) {
                let filasCostos = [];

                for (const claveCosto in costes) {
                    let trCostes = document.createElement('tr');

                    let espacio = document.createElement('td');
                    espacio.classList.add('borde');

                    let elementoNombre = document.createElement('td');
                    elementoNombre.innerHTML = claveCosto;
                    elementoNombre.classList.add('borde');
                    // ðŸ‘‰ AÃ‘ADIDO: Controlador onmouseover (mouse entra)
                    elementoNombre.setAttribute('onmouseover', 'this.style.borderColor="blue"; this.style.borderWidth="3px"');
                    
                    // ðŸ‘‰ AÃ‘ADIDO: Controlador onmouseout (mouse sale)
                    elementoNombre.setAttribute('onmouseout', 'this.style.borderColor="black"; this.style.borderWidth="1px"');


                    let cost = document.createElement('td');
                    cost.innerHTML = costes[claveCosto] + ' â‚¬';
                    cost.classList.add('borde');

                    trCostes.appendChild(espacio);
                    trCostes.appendChild(elementoNombre);
                    trCostes.appendChild(cost);

                    filasCostos.push(trCostes);

                }

                return filasCostos;


            }

            crearTotal(costes) {
                let total = 0;

                for (const claveCosto in costes) {
                    total += parseFloat(costes[claveCosto]);
                }

                let filaTotal = document.createElement('tr');

                let espacio = document.createElement('td');

                let totalEstatico = document.createElement('td');
                totalEstatico.innerHTML = 'Total:';
                totalEstatico.classList.add('borde');
                totalEstatico.classList.add('negrita');


                let resultadoTotal = document.createElement('td');
                resultadoTotal.innerHTML = total.toFixed(2) + ' â‚¬';
                resultadoTotal.classList.add('borde');
                resultadoTotal.classList.add('negrita');

                filaTotal.appendChild(espacio);
                filaTotal.appendChild(totalEstatico);
                filaTotal.appendChild(resultadoTotal);

                return filaTotal;
            }
        }

        class Tabla {
            #dallo;
            #secc;
            constructor(dallo) {
                this.#dallo = JSON.parse(bdDallo)
                console.log(this.#dallo);
                this.#secc = new Secc(dallo);
                this.render();

            }

            render() {
                let tabla = document.createElement('table');
                tabla.classList.add('table');
                let thead = document.createElement('thead');
                let tbody = document.createElement('tbody');

                let cabecera = this.#secc.crearCabecera();

                for (let i = 0; i != this.#dallo.length; i++) {
                    let producto = this.#secc.crearModeloCartera(this.#dallo[i].cod, this.#dallo[i].descrip);
                    tbody.appendChild(producto);

                    let filasCostes = this.#secc.crearCostes(this.#dallo[i].costos);
                    // Iteramos sobre el array y adjuntamos cada fila individualmente al tbody
                    for (const fila of filasCostes) {
                        tbody.appendChild(fila);
                    }

                    let filaTotal = this.#secc.crearTotal(this.#dallo[i].costos);
                    tbody.appendChild(filaTotal);


                }


                thead.appendChild(cabecera);



                tabla.appendChild(thead);
                tabla.appendChild(tbody);

                let addTabla = document.body.appendChild(tabla);

                return addTabla;
            }
        }




        new Tabla(bdDallo);

    </script>
</body>

</html>