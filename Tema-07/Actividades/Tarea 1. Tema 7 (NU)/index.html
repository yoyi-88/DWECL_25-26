<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cesta mejoreada</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <style>
        .derecha {
            text-align: right;
        }

    </style>

    <script>
        class Producto {

            constructor(id, imagen, nombre, precio) {
                this.id = id;
                this.imagen = imagen;                
                this.nombre = nombre;                
                this.precio = precio;             
            }
        }

        class ContProductos {
            #productos;
            constructor(productos) {
                this.#productos = productos;
                this.mostrarProductos();
                
            }

            mostrarProductos() {
                // Obtenemos el id del div en el que insertaremos los productos
                const contenedor = document.getElementById("cards-container");

                // Recorremos el array de objetos de productos y vamos llamando al método crearProducto
                this.#productos.forEach(datos => {
                    var nuevaTarjeta = this.crearProducto(datos);
                    // Añadimos el nuevo producto al contenedor
                    contenedor.appendChild(nuevaTarjeta);
                });
            
            }

            crearProducto(productos) {
                // Creamos la plantilla para los productos
                var card = document.createElement("card");
                card.classList.add('card');
                

                var cardImagen = document.createElement("img");
                cardImagen.src = productos.imagen;

                var cardNombre = document.createElement("h4");
                cardNombre.innerHTML = productos.nombre;

                var cardImput = document.createElement("input");
                cardImput.type = 'number';
                cardImput.placeholder = 'Inserte cantidad';

                var cardPrecio = document.createElement("p");
                cardPrecio.innerHTML = productos.precio;

                var cardBoton = document.createElement("button");
                cardBoton.innerHTML = 'Añadir';
                cardBoton.classList.add('btn');
                cardBoton.classList.add('btn-primary');

                // Proceso para asociar el botón a la cesta
                // Asignamos automáticamente un id por orden a cada botón
                cardBoton.dataset.id = productos.id;
                
                // Añadimos el event listener
                cardBoton.addEventListener('click', () => {
                    const productoId = productos.id;

                    const cantidad = parseInt(cardImput.value);

                    if (cantidad <= 0) {
                        alert("Introduzca un número de productos válido");
                        return;
                    } else if (cantidad > 0) {
                        miCesta.añadirProducto(productoId, cantidad);
                    }
                }); 




                card.appendChild(cardImagen);
                card.appendChild(cardNombre);
                card.appendChild(cardImput);
                card.appendChild(cardPrecio);
                card.appendChild(cardBoton);

                return card;


                
            }

        }
        class Cesta {
            #cesta = [];
            #productos;

            constructor(cesta) {
                this.#cesta = cesta;
                this.#productos = productos;
                
            }

            añadirProducto(productoId, cantidad) {
                const elementoExiste = this.#cesta.find(producto => producto.id === productoId);

                if(!elementoExiste) {
                    this.#cesta.push({id: productoId, cantidad: cantidad });
                } else {
                   elementoExiste.cantidad += cantidad;
                }
                
                

            }

            crearFila(productos, cesta) {
                
                var fila = document.createElement('tr')
                fila.classList.add('tr');

                var filaId = document.createElement('td');
                filaId.innerHTML = cesta.id;
                
                var filaNombre = document.createElement('td');
                filaNombre.innerHTML = productos.nombre;
                
                var filaCantidad = document.createElement('td');
                filaCantidad.innerHTML = cesta.cantidad;
                filaCantidad.type = 'number';

                var filaPrecio = document.createElement('td');
                filaPrecio.type = 'number';
                filaPrecio.innerHTML = productos.precio;
                
                var filaSubtotal = document.createElement('td');
                filaSubtotal.innerHTML = (productos.precio * cesta.cantidad);

                var filaBorrar = document.createElement('button');
                filaBorrar.innerText = "Borrar";
                filaBorrar.classList.add("btn");
                filaBorrar.classList.add("btn-danger");


                filaBorrar.addEventListener('click', () => {fila.remove(fila)}); 



                filaId.appendChild(fila);
                filaNombre.appendChild(fila);
                filaCantidad.appendChild(fila);
                filaPrecio.appendChild(fila);
                filaSubtotal.appendChild(fila);
            }

            mostrarCesta() {
                let contenedorCesta = document.getElementById("cestaProductos");
                contenedorCesta.innerHTML = '';

                for (let item of this.#cesta) {

                }
                
            }

        }

        var productos = [
            {id: 1, imagen: "img/monsuno.jpg", nombre: "Monsuno", precio: 10},
            {id: 2, imagen: "img/bayblade.jpg", nombre:"Bayblade", precio: 15},
            {id: 3, imagen: "img/zomblings.jpg", nombre: "Zombligs", precio: 5},
            {id: 4, imagen: "img/bakugans.jpg", nombre: "Bakugans", precio: 12},
            {id: 5, imagen: "img/estampitas.jpg", nombre: "Estampitas", precio: 3},
            {id: 6, imagen: "img/cromos.jpg", nombre: "Cromos", precio: 35}
        ]; 


        var miCesta = new Cesta();

        window.onload=()=>new ContProductos(productos, miCesta);

        
    </script>
</head>

<body>


    <div class="container text-center">
        <div class="row">
            <div class="col">
                <header>
                    <h1>El rastro de yoyi</h1>
                    <h4>Ejemplo de cesta dinámica</h4>
                </header>
            </div>
        </div>
        <div class="row row-cols-2">
            <div class="col">
                <div class="container text-center">
                    <div id="cards-container" class="row row-cols-3">
                             
                    </div>
                </div>
            </div>
            <div class="col">
                <img src="https://img.icons8.com/shopping-basket" alt="">
                <h2>Cesta</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Cod.</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Cantidad</th>
                            <th scope="col">Precio (€)</th>
                            <th scope="col">Subtotal</th>
                        </tr>
                    </thead>
                    <tbody id="cestaProductos">
                    </tbody>
                            
                </table>
                <p class="derecha">Total: €</p>
                <p class="derecha">Total + IVA (21%): €</p>
            </div>
        </div>
    </div>

</body>

</html>